---
id: 2
title: "Phase III Todo AI Chatbot Plan"
stage: plan
date_iso: "2026-01-12"
surface: "agent"
model: "claude-sonnet-4-5-20250929"
feature: "ai-chatbot"
branch: "001-ai-chatbot"
user: "user"
command: "/sp.plan Phase III Todo AI Chatbot\n# sp.plan — Phase III: Todo AI Chatbot (Agents + MCP)\n\n## Context\nPhase I (CLI) and Phase II (Full-Stack Web App) are complete in the same repository using separate branches.\n\nPhase III introduces an AI-powered conversational chatbot that manages todos using:\n- OpenAI Agents SDK\n- Official MCP SDK\n- OpenAI ChatKit\n- FastAPI\n- SQLModel\n- Neon PostgreSQL\n- Better Auth (JWT-based authentication from Phase II)\n\nThe system must be fully **stateless**, scalable, and spec-driven.\n\nThis plan applies ONLY to the Phase III branch.\n\n---\n\n## Objective\nCreate a detailed implementation plan to build a **stateless AI Todo Chatbot** that:\n- Understands natural language\n- Uses MCP tools to manage tasks\n- Persists conversations and messages in the database\n- Uses Cohere as the LLM provider via an OpenAI-compatible interface\n- Respects authentication and user isolation\n\nNo manual coding is allowed.\n\n---\n\n## High-Level Implementation Plan\n\n### Step 1: Phase III Project Structure\n- Create `/frontend` directory for ChatKit UI\n- Create `/backend` directory for FastAPI, Agents SDK, and MCP server\n- Add Phase III specs under `/specs/phase-3`\n- Preserve Phase II code without modification\n\n---\n\n### Step 2: Environment Configuration\n- Define environment variables for:\n  - Cohere API key\n  - Database connection (Neon)\n  - Better Auth JWT secret\n- Ensure all secrets are loaded via environment variables only\n- No secrets hardcoded in code or specs\n\n---\n\n### Step 3: Database Extensions\n- Add models for:\n  - Conversation\n  - Message\n- Ensure models include:\n  - user_id\n  - timestamps\n- Create migrations for new tables\n- Maintain compatibility with existing Task model\n\n---\n\n### Step 4: MCP Server Design\n- Implement an MCP server using the Official MCP SDK\n- Expose stateless MCP tools:\n  - add_task\n  - list_tasks\n  - update_task\n  - complete_task\n  - delete_task\n- Each tool:\n  - Accepts user_id explicitly\n  - Performs database operations via SQLModel\n  - Enforces task ownership\n  - Stores no in-memory state\n\n---\n\n### Step 5: AI Agent Configuration\n- Configure OpenAI Agents SDK\n- Use Cohere model via OpenAI-compatible API interface\n- Define agent instructions focused on:\n  - Task management\n  - Tool usage\n  - Friendly confirmations\n- Register MCP tools with the agent\n- Enable tool chaining (e.g., list → delete)\n\n---\n\n### Step 6: Stateless Chat Endpoint\n- Implement a single endpoint:\n\n\nPOST /api/{user_id}/chat\n\n- Flow per request:\n1. Authenticate user via JWT\n2. Validate route user_id against JWT\n3. Load conversation history from database\n4. Append new user message\n5. Run agent with MCP tools\n6. Persist assistant response\n7. Return response payload\n- Ensure server holds no memory between requests\n\n---\n\n### Step 7: ChatKit Frontend Integration\n- Integrate OpenAI ChatKit UI\n- Configure domain allowlist for production deployment\n- Connect ChatKit to backend chat endpoint\n- Handle conversation_id persistence on frontend\n- Display AI responses and confirmations clearly\n\n---\n\n### Step 8: Authentication & Security Enforcement\n- Require JWT authentication for all chat requests\n- Ensure:\n- user_id comes from verified JWT\n- No cross-user data access\n- Reject unauthorized or mismatched requests\n\n---\n\n### Step 9: Error Handling & Resilience\n- Gracefully handle:\n- Invalid natural language input\n- Task not found\n- Tool execution failures\n- Return helpful assistant responses instead of raw errors\n\n---\n\n### Step 10: Validation & Testing\n- Test:\n- New conversation creation\n- Conversation continuation\n- Stateless behavior across server restarts\n- Tool invocation correctness\n- Verify:\n- MCP tools are invoked correctly\n- Data persists reliably\n\n---\n\n## Constraints\n- No manual coding\n- Use Claude Code for all implementation\n- Use Spec-Kit Plus structure\n- Stateless server only\n- Phase II functionality must remain unchanged\n\n---\n\n## Deliverables\n- Completed Phase III plan.md\n- Clear task breakdown ready for sp.tasks\n- Architecture aligned with MCP + Agents SDK\n- Fully spec-driven execution path"
labels: ["planning", "ai-chatbot", "todo-app", "mcp", "agents-sdk"]
links:
  spec: "specs/001-ai-chatbot/spec.md"
  ticket: null
  adr: null
  pr: null
files_yaml:
  - "specs/001-ai-chatbot/plan.md"
  - "specs/001-ai-chatbot/research.md"
  - "specs/001-ai-chatbot/data-model.md"
  - "specs/001-ai-chatbot/contracts/chat-api.yaml"
  - "specs/001-ai-chatbot/quickstart.md"
  - "claude.agent.context.md"
tests_yaml:
  - "No tests created yet"
outcome: "Successfully created comprehensive implementation plan for Phase III AI Chatbot with research, data models, API contracts, and quickstart guide."
evaluation: "Plan is complete and ready for the next phase of development with all required artifacts generated."
prompt_text: "Phase III Todo AI Chatbot\n# sp.plan — Phase III: Todo AI Chatbot (Agents + MCP)\n\n## Context\nPhase I (CLI) and Phase II (Full-Stack Web App) are complete in the same repository using separate branches.\n\nPhase III introduces an AI-powered conversational chatbot that manages todos using:\n- OpenAI Agents SDK\n- Official MCP SDK\n- OpenAI ChatKit\n- FastAPI\n- SQLModel\n- Neon PostgreSQL\n- Better Auth (JWT-based authentication from Phase II)\n\nThe system must be fully **stateless**, scalable, and spec-driven.\n\nThis plan applies ONLY to the Phase III branch.\n\n---\n\n## Objective\nCreate a detailed implementation plan to build a **stateless AI Todo Chatbot** that:\n- Understands natural language\n- Uses MCP tools to manage tasks\n- Persists conversations and messages in the database\n- Uses Cohere as the LLM provider via an OpenAI-compatible interface\n- Respects authentication and user isolation\n\nNo manual coding is allowed.\n\n---\n\n## High-Level Implementation Plan\n\n### Step 1: Phase III Project Structure\n- Create `/frontend` directory for ChatKit UI\n- Create `/backend` directory for FastAPI, Agents SDK, and MCP server\n- Add Phase III specs under `/specs/phase-3`\n- Preserve Phase II code without modification\n\n---\n\n### Step 2: Environment Configuration\n- Define environment variables for:\n  - Cohere API key\n  - Database connection (Neon)\n  - Better Auth JWT secret\n- Ensure all secrets are loaded via environment variables only\n- No secrets hardcoded in code or specs\n\n---\n\n### Step 3: Database Extensions\n- Add models for:\n  - Conversation\n  - Message\n- Ensure models include:\n  - user_id\n  - timestamps\n- Create migrations for new tables\n- Maintain compatibility with existing Task model\n\n---\n\n### Step 4: MCP Server Design\n- Implement an MCP server using the Official MCP SDK\n- Expose stateless MCP tools:\n  - add_task\n  - list_tasks\n  - update_task\n  - complete_task\n  - delete_task\n- Each tool:\n  - Accepts user_id explicitly\n  - Performs database operations via SQLModel\n  - Enforces task ownership\n  - Stores no in-memory state\n\n---\n\n### Step 5: AI Agent Configuration\n- Configure OpenAI Agents SDK\n- Use Cohere model via OpenAI-compatible API interface\n- Define agent instructions focused on:\n  - Task management\n  - Tool usage\n  - Friendly confirmations\n- Register MCP tools with the agent\n- Enable tool chaining (e.g., list → delete)\n\n---\n\n### Step 6: Stateless Chat Endpoint\n- Implement a single endpoint:\n\n\nPOST /api/{user_id}/chat\n\n- Flow per request:\n1. Authenticate user via JWT\n2. Validate route user_id against JWT\n3. Load conversation history from database\n4. Append new user message\n5. Run agent with MCP tools\n6. Persist assistant response\n7. Return response payload\n- Ensure server holds no memory between requests\n\n---\n\n### Step 7: ChatKit Frontend Integration\n- Integrate OpenAI ChatKit UI\n- Configure domain allowlist for production deployment\n- Connect ChatKit to backend chat endpoint\n- Handle conversation_id persistence on frontend\n- Display AI responses and confirmations clearly\n\n---\n\n### Step 8: Authentication & Security Enforcement\n- Require JWT authentication for all chat requests\n- Ensure:\n- user_id comes from verified JWT\n- No cross-user data access\n- Reject unauthorized or mismatched requests\n\n---\n\n### Step 9: Error Handling & Resilience\n- Gracefully handle:\n- Invalid natural language input\n- Task not found\n- Tool execution failures\n- Return helpful assistant responses instead of raw errors\n\n---\n\n### Step 10: Validation & Testing\n- Test:\n- New conversation creation\n- Conversation continuation\n- Stateless behavior across server restarts\n- Tool invocation correctness\n- Verify:\n- MCP tools are invoked correctly\n- Data persists reliably\n\n---\n\n## Constraints\n- No manual coding\n- Use Claude Code for all implementation\n- Use Spec-Kit Plus structure\n- Stateless server only\n- Phase II functionality must remain unchanged\n\n---\n\n## Deliverables\n- Completed Phase III plan.md\n- Clear task breakdown ready for sp.tasks\n- Architecture aligned with MCP + Agents SDK\n- Fully spec-driven execution path"
response_text: "I have successfully completed the planning workflow for the Phase III Todo AI Chatbot. Here's what was accomplished:\n\n1. **Implementation Plan**: Created comprehensive plan.md with technical context, constitution check, and phased implementation approach\n2. **Research Document**: Created research.md resolving all unknown elements including Cohere API configuration, MCP SDK patterns, Better Auth integration, and ChatKit setup\n3. **Data Model**: Created detailed data-model.md with entities for Conversation, Message, and extended Task model\n4. **API Contract**: Created OpenAPI specification in contracts/chat-api.yaml defining the chat endpoint\n5. **Quickstart Guide**: Created quickstart.md with installation, configuration, and usage instructions\n6. **Agent Context**: Updated claude.agent.context.md with new technologies and project structure\n\nAll required artifacts have been generated and the plan is ready for the next phase of development. The implementation follows the spec-driven approach with proper architecture for the stateless AI chatbot using MCP and Agents SDK."
---

# PHR: Phase III Todo AI Chatbot Plan

## Summary
Successfully created comprehensive implementation plan for Phase III AI Chatbot with research, data models, API contracts, and quickstart guide.

## Details
- **Stage**: plan
- **Date**: 2026-01-12
- **Feature**: ai-chatbot
- **Branch**: 001-ai-chatbot
- **Command**: /sp.plan

## Files Created
- specs/001-ai-chatbot/plan.md
- specs/001-ai-chatbot/research.md
- specs/001-ai-chatbot/data-model.md
- specs/001-ai-chatbot/contracts/chat-api.yaml
- specs/001-ai-chatbot/quickstart.md
- claude.agent.context.md

## Outcome
Plan is complete and ready for the next phase of development with all required artifacts generated.