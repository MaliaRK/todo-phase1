# Implementation Plan: Todo CLI with Intermediate Features

## Feature Information
- **Feature**: Todo CLI with Intermediate Features
- **Branch**: 003-todo-intermediate-features
- **Specification**: specs/003-todo-intermediate-features/spec.md
- **Technology Stack**: UV, Python 3.13+, Claude Code, Spec-Kit Plus

## 1. Impact Analysis

### Existing Files Affected
- `src/models.py` - Extend Task model to include priority and tags
- `src/services.py` - Add search, filter, and sort functionality
- `src/main.py` or `src/cli.py` - Replace command-line parsing with menu-driven interface
- `src/__init__.py` - Update module imports if needed

### Components Remaining Unchanged
- Core task creation, viewing, updating, deletion logic
- Basic completion/incompletion functionality
- In-memory storage mechanism
- Core application structure

## 2. Technical Context

### Architecture Overview
- **Models Layer**: Extended Task model with priority and tags
- **Services Layer**: Enhanced with search, filter, and sort operations
- **CLI Layer**: Menu-driven interface replacing command-line parsing
- **Storage**: In-memory only, maintaining existing patterns

### Data Flow
1. CLI receives user input through menu options
2. CLI calls service layer methods
3. Service layer manipulates data models
4. Data stored in memory with extended attributes

### Dependencies
- Python 3.13+
- UV package manager
- Standard library modules only (no external dependencies)

## 3. Constitution Check

### Compliance Verification
- ✅ All code will be generated by Claude Code (no manual writing)
- ✅ Code will reside in `/src` directory with modular structure
- ✅ Application will be console-based with in-memory storage only
- ✅ Clean separation of concerns maintained
- ✅ Python 3.13+ compatibility ensured
- ✅ No global mutable state leakage

### Architecture Principles
- **Separation of Concerns**: Models, services, and CLI logic remain separate
- **Modularity**: Each component has clear, distinct responsibilities
- **Spec-Driven**: All implementation follows the approved specification
- **Maintainability**: Clean, readable code with clear function responsibilities

## 4. Implementation Gates

### Gate 1: Specification Compliance
- ✅ All intermediate features mapped to implementation steps
- ✅ No advanced features included
- ✅ Existing basic functionality preserved

### Gate 2: Architecture Compliance
- ✅ Clean separation of concerns maintained
- ✅ Modular structure preserved
- ✅ In-memory storage constraint respected

### Gate 3: Technology Compliance
- ✅ Python 3.13+ compatibility
- ✅ UV package management
- ✅ Claude Code generation mandate

## 5. Phase 0: Research & Analysis

### Research Tasks Identified
1. **Priority Implementation**: Best approach for implementing priority levels (enum vs string)
2. **Tag Storage**: Optimal data structure for storing multiple tags per task
3. **Search Algorithm**: Efficient search across title, description, and tags
4. **Filter Performance**: Optimized filtering by status, priority, and tags
5. **Sort Algorithms**: Priority-based and alphabetical sorting implementations
6. **Menu Interface**: Best practices for numeric menu-driven CLI interfaces

### Assumptions Made
- Basic task model structure follows standard Python class patterns
- In-memory storage uses Python lists/dictionaries
- CLI uses standard input/output for user interaction
- Task IDs are integers assigned sequentially

## 6. Phase 1: Design & Contracts

### Data Model Extension
**File: `src/models.py`**

- **Task Class Extension**:
  - Add `priority` attribute (values: "High", "Medium", "Low", default: "Medium")
  - Add `tags` attribute (type: list of strings)
  - Update constructor to accept priority and tags parameters
  - Update string representation to include priority and tags

### Service Layer Enhancements
**File: `src/services.py`**

- **Search Functionality**:
  - `search_tasks(keyword: str)` - Returns tasks matching keyword in title, description, or tags
  - Search algorithm checks all three fields case-insensitively

- **Filter Functionality**:
  - `filter_by_status(completed: bool)` - Filter by completion status
  - `filter_by_priority(priority: str)` - Filter by priority level
  - `filter_by_tag(tag: str)` - Filter by specific tag

- **Sort Functionality**:
  - `sort_by_priority(tasks)` - Sort with High first, then Medium, then Low
  - `sort_alphabetically(tasks)` - Sort by title alphabetically
  - Maintain default sort by creation order

### CLI Interface Redesign
**File: `src/main.py` or `src/cli.py`**

- **Menu System**:
  - Replace command-line argument parsing with numeric menu options
  - Implement main menu loop with options 1-10
  - Add input validation and error handling
  - Implement graceful exit functionality

- **User Interaction Flows**:
  - Enhanced task creation flow with priority and tags input
  - Search interface with keyword input
  - Filter selection interface
  - Sort selection interface
  - Consistent output formatting for task displays

## 7. Implementation Steps

### Step 1: Extend Data Model
1. Modify `Task` class in `models.py` to include priority and tags
2. Update constructor to accept priority and tags parameters
3. Ensure default priority is "Medium"
4. Add validation for priority values (High/Medium/Low)

### Step 2: Update Services Layer
1. Add search functionality to find tasks by keyword across title, description, and tags
2. Implement filtering methods for status, priority, and tags
3. Implement sorting methods for priority and alphabetical ordering
4. Maintain existing basic CRUD operations

### Step 3: Redesign CLI Interface
1. Replace command-line argument parsing with menu system
2. Implement main menu with 10 numbered options
3. Create dedicated functions for each menu option
4. Add input validation and user-friendly error messages
5. Implement enhanced task display showing all attributes

### Step 4: Integrate Components
1. Connect CLI menu options to service layer methods
2. Ensure proper data flow between layers
3. Test all new functionality with existing features
4. Verify backward compatibility with basic features

### Step 5: Testing & Validation
1. Test all new intermediate features
2. Verify existing basic functionality remains intact
3. Validate error handling and edge cases
4. Confirm performance requirements are met

## 8. File Structure Changes

### New/Modified Files
- `src/models.py` - Extended Task model with priority and tags
- `src/services.py` - Enhanced with search, filter, and sort operations
- `src/main.py` - Menu-driven CLI interface implementation
- `src/cli.py` - (if separate CLI module exists) Menu interface logic

### Preserved Files
- All existing basic functionality files remain intact
- In-memory storage mechanisms unchanged
- Core application structure maintained

## 9. Risk Mitigation

### Potential Risks
1. **Backward Compatibility**: Ensure existing functionality remains intact
   - Mitigation: Thorough testing of basic operations after changes

2. **Performance**: New search/filter operations may slow down application
   - Mitigation: Efficient algorithms and in-memory operations only

3. **User Experience**: Menu-driven interface might be less intuitive
   - Mitigation: Clear prompts and consistent interface design

4. **Data Validation**: New attributes need proper validation
   - Mitigation: Implement validation rules for priority and tags

## 10. Success Criteria Verification

### Measurable Outcomes
- Tasks can be created with priority and tags in under 30 seconds
- Search returns results within 1 second
- Filter operations complete within 1 second
- Sort operations complete within 1 second
- 95% of users can navigate menu interface on first attempt
- All basic operations continue to work without issues
- 90% improvement in task organization compared to basic version
- No performance degradation from basic version

### Verification Methods
- Manual testing of all new features
- Performance benchmarking of search/filter/sort operations
- User interface testing for menu navigation
- Regression testing of existing functionality

This implementation plan provides a clear roadmap for extending the basic todo CLI application with intermediate features while maintaining all existing functionality and adhering to the specified architecture principles.